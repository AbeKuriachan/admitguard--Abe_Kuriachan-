<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AdmitGuard â€“ Candidate Form</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="form.css">
</head>
<body>

  <!-- TOP NAV -->
  <nav class="topnav">
    <div class="nav-left">
      <img src="logo.svg" alt="AdmitGuard" width="30" height="30" style="border-radius:7px;">
      <span class="nav-brand">AdmitGuard</span>
    </div>
    <div class="nav-right">
      <button id="themeToggle" class="theme-toggle" aria-label="Toggle theme">ðŸŒ™</button>
      <div class="user-menu" id="userMenu" onclick="toggleUserDropdown()">
        <div class="avatar" id="userAvatar">A</div>
        <span class="user-name" id="userName">User</span>
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"/></svg>
        <div class="dropdown" id="userDropdown">
          <div class="dropdown-item" onclick="handleLogout()">
            <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
            Logout
          </div>
        </div>
      </div>
    </div>
  </nav>

  <main class="main">

    <!-- BREADCRUMB -->
    <div class="breadcrumb">
      <a href="dashboard.html" class="breadcrumb-link">Dashboard</a>
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
      <a href="#" class="breadcrumb-link" id="breadcrumbBatch">Batch</a>
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
      <span id="breadcrumbForm">New Student</span>
    </div>

    <!-- FORM CARD -->
    <div class="form-card" id="formCard">

      <div class="form-card-header">
        <div>
          <h1 class="form-title" id="formTitle">Candidate Admission Form</h1>
          <p class="form-sub" id="formSub">Fill all sections carefully. Violations will be highlighted.</p>
        </div>
      </div>

      <!-- FLAG BANNER (appears if >2 exceptions) -->
      <div class="flag-banner hidden" id="flagBanner">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" y1="22" x2="4" y2="15"/></svg>
        This candidate has more than 2 exceptions and will be flagged for manager review.
      </div>

      <!-- SECTION 1: PERSONAL -->
      <div class="form-section" id="section1">
        <div class="section-header" onclick="toggleSection(1)">
          <div class="section-header-left">
            <span class="section-num">1</span>
            <div>
              <span class="section-title">Personal Details</span>
              <span class="section-status" id="sec1Status"></span>
            </div>
          </div>
          <svg class="chevron open" id="chevron1" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="18 15 12 9 6 15"/></svg>
        </div>
        <div class="section-body open" id="body1">
          <div class="fields-grid">

            <!-- Full Name -->
            <div class="field-block full-width" id="block_full_name">
              <label>Full Name <span class="required">*</span></label>
              <input type="text" id="full_name" placeholder="e.g. Priya Sharma" oninput="validateField('full_name')"/>
              <div class="error-zone hidden"   id="err_full_name"></div>
              <div class="warning-zone hidden" id="warn_full_name"></div>
              <div class="exception-zone hidden" id="exc_full_name">
                <label class="exc-toggle-label">
                  <input type="checkbox" id="excCheck_full_name" onchange="toggleException('full_name')"/>
                  Allow exception for this field
                </label>
                <textarea id="excReason_full_name" class="rationale-textarea hidden"
                  placeholder="Provide rationale (min 30 chars). Must include: 'approved by', 'special case', 'documentation pending', or 'waiver granted'."
                  oninput="validateRationale('full_name')"></textarea>
                <div class="rationale-error hidden" id="excErr_full_name"></div>
              </div>
            </div>

            <!-- Email -->
            <div class="field-block" id="block_email">
              <label>Email Address <span class="required">*</span></label>
              <input type="email" id="email" placeholder="e.g. priya@example.com" oninput="validateField('email')"/>
              <div class="error-zone hidden"   id="err_email"></div>
              <div class="warning-zone hidden" id="warn_email"></div>
              <div class="exception-zone hidden" id="exc_email">
                <label class="exc-toggle-label">
                  <input type="checkbox" id="excCheck_email" onchange="toggleException('email')"/>
                  Allow exception for this field
                </label>
                <textarea id="excReason_email" class="rationale-textarea hidden"
                  placeholder="Provide rationaleâ€¦"
                  oninput="validateRationale('email')"></textarea>
                <div class="rationale-error hidden" id="excErr_email"></div>
              </div>
            </div>

            <!-- Phone -->
            <div class="field-block" id="block_phone">
              <label>Phone Number <span class="required">*</span></label>
              <input type="text" id="phone" placeholder="e.g. 9876543210" maxlength="10" oninput="validateField('phone')"/>
              <div class="error-zone hidden"   id="err_phone"></div>
              <div class="warning-zone hidden" id="warn_phone"></div>
              <div class="exception-zone hidden" id="exc_phone">
                <label class="exc-toggle-label">
                  <input type="checkbox" id="excCheck_phone" onchange="toggleException('phone')"/>
                  Allow exception for this field
                </label>
                <textarea id="excReason_phone" class="rationale-textarea hidden"
                  placeholder="Provide rationaleâ€¦"
                  oninput="validateRationale('phone')"></textarea>
                <div class="rationale-error hidden" id="excErr_phone"></div>
              </div>
            </div>

            <!-- Date of Birth -->
            <div class="field-block" id="block_date_of_birth">
              <label>Date of Birth <span class="soft-tag">Soft</span></label>
              <input type="date" id="date_of_birth" oninput="validateField('date_of_birth')" onchange="validateField('date_of_birth')"/>
              <div class="error-zone hidden"   id="err_date_of_birth"></div>
              <div class="warning-zone hidden" id="warn_date_of_birth"></div>
              <div class="exception-zone hidden" id="exc_date_of_birth">
                <label class="exc-toggle-label">
                  <input type="checkbox" id="excCheck_date_of_birth" onchange="toggleException('date_of_birth')"/>
                  Allow exception for this field
                </label>
                <textarea id="excReason_date_of_birth" class="rationale-textarea hidden"
                  placeholder="Provide rationaleâ€¦"
                  oninput="validateRationale('date_of_birth')"></textarea>
                <div class="rationale-error hidden" id="excErr_date_of_birth"></div>
              </div>
            </div>

          </div>
        </div>
      </div>

      <!-- SECTION 2: ACADEMIC -->
      <div class="form-section" id="section2">
        <div class="section-header" onclick="toggleSection(2)">
          <div class="section-header-left">
            <span class="section-num">2</span>
            <div>
              <span class="section-title">Academic Details</span>
              <span class="section-status" id="sec2Status"></span>
            </div>
          </div>
          <svg class="chevron" id="chevron2" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="18 15 12 9 6 15"/></svg>
        </div>
        <div class="section-body" id="body2">
          <div class="fields-grid">

            <!-- Highest Qualification -->
            <div class="field-block" id="block_qualification">
              <label>Highest Qualification <span class="required">*</span></label>
              <select id="qualification" onchange="validateField('qualification')">
                <option value="">Select qualification</option>
              </select>
              <div class="error-zone hidden"   id="err_qualification"></div>
              <div class="warning-zone hidden" id="warn_qualification"></div>
              <div class="exception-zone hidden" id="exc_qualification">
                <label class="exc-toggle-label">
                  <input type="checkbox" id="excCheck_qualification" onchange="toggleException('qualification')"/>
                  Allow exception for this field
                </label>
                <textarea id="excReason_qualification" class="rationale-textarea hidden"
                  placeholder="Provide rationaleâ€¦"
                  oninput="validateRationale('qualification')"></textarea>
                <div class="rationale-error hidden" id="excErr_qualification"></div>
              </div>
            </div>

            <!-- Graduation Year -->
            <div class="field-block" id="block_graduation_year">
              <label>Graduation Year <span class="soft-tag">Soft</span></label>
              <input type="number" id="graduation_year" placeholder="e.g. 2021" min="2000" max="2030" oninput="validateField('graduation_year')"/>
              <div class="error-zone hidden"   id="err_graduation_year"></div>
              <div class="warning-zone hidden" id="warn_graduation_year"></div>
              <div class="exception-zone hidden" id="exc_graduation_year">
                <label class="exc-toggle-label">
                  <input type="checkbox" id="excCheck_graduation_year" onchange="toggleException('graduation_year')"/>
                  Allow exception for this field
                </label>
                <textarea id="excReason_graduation_year" class="rationale-textarea hidden"
                  placeholder="Provide rationaleâ€¦"
                  oninput="validateRationale('graduation_year')"></textarea>
                <div class="rationale-error hidden" id="excErr_graduation_year"></div>
              </div>
            </div>

            <!-- Percentage / CGPA -->
            <div class="field-block full-width" id="block_percentage_cgpa">
              <label>
                Percentage / CGPA <span class="soft-tag">Soft</span>
                <span class="mode-toggle">
                  <button type="button" class="mode-btn active" id="modePercent" onclick="setScoreMode('percent')">%</button>
                  <button type="button" class="mode-btn" id="modeCgpa" onclick="setScoreMode('cgpa')">CGPA</button>
                </span>
              </label>
              <input type="number" id="percentage_cgpa" placeholder="e.g. 75" step="0.01" oninput="validateField('percentage_cgpa')"/>
              <div class="field-hint" id="scoreHint">Enter percentage (0â€“100)</div>
              <div class="error-zone hidden"   id="err_percentage_cgpa"></div>
              <div class="warning-zone hidden" id="warn_percentage_cgpa"></div>
              <div class="exception-zone hidden" id="exc_percentage_cgpa">
                <label class="exc-toggle-label">
                  <input type="checkbox" id="excCheck_percentage_cgpa" onchange="toggleException('percentage_cgpa')"/>
                  Allow exception for this field
                </label>
                <textarea id="excReason_percentage_cgpa" class="rationale-textarea hidden"
                  placeholder="Provide rationaleâ€¦"
                  oninput="validateRationale('percentage_cgpa')"></textarea>
                <div class="rationale-error hidden" id="excErr_percentage_cgpa"></div>
              </div>
            </div>

          </div>
        </div>
      </div>

      <!-- SECTION 3: EVALUATION -->
      <div class="form-section" id="section3">
        <div class="section-header" onclick="toggleSection(3)">
          <div class="section-header-left">
            <span class="section-num">3</span>
            <div>
              <span class="section-title">Evaluation</span>
              <span class="section-status" id="sec3Status"></span>
            </div>
          </div>
          <svg class="chevron" id="chevron3" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="18 15 12 9 6 15"/></svg>
        </div>
        <div class="section-body" id="body3">
          <div class="fields-grid">

            <!-- Screening Test Score -->
            <div class="field-block" id="block_screening_score">
              <label>Screening Test Score <span class="soft-tag">Soft</span></label>
              <input type="number" id="screening_score" placeholder="e.g. 65" min="0" max="100" oninput="validateField('screening_score')"/>
              <div class="field-hint">Score out of 100</div>
              <div class="error-zone hidden"   id="err_screening_score"></div>
              <div class="warning-zone hidden" id="warn_screening_score"></div>
              <div class="exception-zone hidden" id="exc_screening_score">
                <label class="exc-toggle-label">
                  <input type="checkbox" id="excCheck_screening_score" onchange="toggleException('screening_score')"/>
                  Allow exception for this field
                </label>
                <textarea id="excReason_screening_score" class="rationale-textarea hidden"
                  placeholder="Provide rationaleâ€¦"
                  oninput="validateRationale('screening_score')"></textarea>
                <div class="rationale-error hidden" id="excErr_screening_score"></div>
              </div>
            </div>

            <!-- Interview Status -->
            <div class="field-block" id="block_interview_status">
              <label>Interview Status <span class="required">*</span></label>
              <select id="interview_status" onchange="validateField('interview_status'); validateField('offer_letter_sent');">
                <option value="">Select status</option>
                <option value="Cleared">Cleared</option>
                <option value="Waitlisted">Waitlisted</option>
                <option value="Rejected">Rejected</option>
              </select>
              <div class="error-zone hidden"   id="err_interview_status"></div>
              <div class="warning-zone hidden" id="warn_interview_status"></div>
              <div class="exception-zone hidden" id="exc_interview_status">
                <label class="exc-toggle-label">
                  <input type="checkbox" id="excCheck_interview_status" onchange="toggleException('interview_status')"/>
                  Allow exception for this field
                </label>
                <textarea id="excReason_interview_status" class="rationale-textarea hidden"
                  placeholder="Provide rationaleâ€¦"
                  oninput="validateRationale('interview_status')"></textarea>
                <div class="rationale-error hidden" id="excErr_interview_status"></div>
              </div>
            </div>

          </div>
        </div>
      </div>

      <!-- SECTION 4: IDENTITY -->
      <div class="form-section" id="section4">
        <div class="section-header" onclick="toggleSection(4)">
          <div class="section-header-left">
            <span class="section-num">4</span>
            <div>
              <span class="section-title">Identity Verification</span>
              <span class="section-status" id="sec4Status"></span>
            </div>
          </div>
          <svg class="chevron" id="chevron4" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="18 15 12 9 6 15"/></svg>
        </div>
        <div class="section-body" id="body4">
          <div class="fields-grid">

            <!-- Aadhaar -->
            <div class="field-block" id="block_aadhaar">
              <label>Aadhaar Number <span class="required">*</span></label>
              <input type="text" id="aadhaar" placeholder="12-digit Aadhaar number" maxlength="12" oninput="validateField('aadhaar')"/>
              <div class="error-zone hidden"   id="err_aadhaar"></div>
              <div class="warning-zone hidden" id="warn_aadhaar"></div>
              <div class="exception-zone hidden" id="exc_aadhaar">
                <label class="exc-toggle-label">
                  <input type="checkbox" id="excCheck_aadhaar" onchange="toggleException('aadhaar')"/>
                  Allow exception for this field
                </label>
                <textarea id="excReason_aadhaar" class="rationale-textarea hidden"
                  placeholder="Provide rationaleâ€¦"
                  oninput="validateRationale('aadhaar')"></textarea>
                <div class="rationale-error hidden" id="excErr_aadhaar"></div>
              </div>
            </div>

            <!-- Offer Letter Sent -->
            <div class="field-block" id="block_offer_letter">
              <label>Offer Letter Sent <span class="required">*</span></label>
              <select id="offer_letter" onchange="validateField('offer_letter_sent')">
                <option value="">Select</option>
                <option value="true">Yes</option>
                <option value="false">No</option>
              </select>
              <div class="field-hint" id="offerHint">Only allowed if Interview Status is Cleared or Waitlisted</div>
              <div class="error-zone hidden"   id="err_offer_letter_sent"></div>
              <div class="warning-zone hidden" id="warn_offer_letter_sent"></div>
              <div class="exception-zone hidden" id="exc_offer_letter_sent">
                <label class="exc-toggle-label">
                  <input type="checkbox" id="excCheck_offer_letter_sent" onchange="toggleException('offer_letter_sent')"/>
                  Allow exception for this field
                </label>
                <textarea id="excReason_offer_letter_sent" class="rationale-textarea hidden"
                  placeholder="Provide rationaleâ€¦"
                  oninput="validateRationale('offer_letter_sent')"></textarea>
                <div class="rationale-error hidden" id="excErr_offer_letter_sent"></div>
              </div>
            </div>

          </div>
        </div>
      </div>

    </div><!-- end form-card -->

  </main>

  <!-- STICKY FOOTER -->
  <div class="sticky-footer" id="stickyFooter">
    <div class="footer-left">
      <div class="exc-counter" id="excCounter">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
        <span id="excCounterText">0 exceptions</span>
      </div>
    </div>
    <div class="footer-right">
      <button class="btn-secondary" onclick="cancelForm()">Cancel</button>
      <button class="btn-submit" id="submitBtn" onclick="handleSubmit()">
        <span id="submitBtnText">Submit Candidate</span>
      </button>
    </div>
  </div>

  <!-- SUCCESS SCREEN -->
  <div class="success-overlay hidden" id="successOverlay">
    <div class="success-card">
      <div class="success-icon">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
      </div>
      <h2 class="success-title">Candidate Submitted!</h2>
      <p class="success-sub" id="successSub">The candidate has been successfully saved.</p>
      <div class="success-summary" id="successSummary"></div>
      <div class="success-actions">
        <button class="btn-secondary" onclick="addAnother()">Add Another</button>
        <button class="btn-primary-sm" onclick="goToBatch()">Back to Batch</button>
      </div>
    </div>
  </div>

  <div id="toast"></div>
  <script src="rules_default.js"></script>
  <script src="theme.js"></script>
  <script src="form.js"></script>
</body>
</html>